<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create propensity scores — createPs • CohortMethod</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create propensity scores — createPs" />
<meta property="og:description" content="Creates propensity scores using a regularized logistic regression." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CohortMethod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/MultipleAnalyses.html">Running multiple analyses at once using the CohortMethod package</a>
    </li>
    <li>
      <a href="../articles/SingleStudies.html">Single studies using the CohortMethod package</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/CohortMethod/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create propensity scores</h1>
    <small class="dont-index">Source: <a href='https://github.com/OHDSI/CohortMethod/blob/master/R/PsFunctions.R'><code>R/PsFunctions.R</code></a></small>
    <div class="hidden name"><code>createPs.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates propensity scores using a regularized logistic regression.</p>
    </div>

    <pre class="usage"><span class='fu'>createPs</span><span class='op'>(</span>
  <span class='va'>cohortMethodData</span>,
  population <span class='op'>=</span> <span class='cn'>NULL</span>,
  excludeCovariateIds <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span>,
  includeCovariateIds <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span>,
  maxCohortSizeForFitting <span class='op'>=</span> <span class='fl'>250000</span>,
  errorOnHighCorrelation <span class='op'>=</span> <span class='cn'>TRUE</span>,
  stopOnError <span class='op'>=</span> <span class='cn'>TRUE</span>,
  prior <span class='op'>=</span> <span class='fu'>createPrior</span><span class='op'>(</span><span class='st'>"laplace"</span>, exclude <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>)</span>, useCrossValidation <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  control <span class='op'>=</span> <span class='fu'>createControl</span><span class='op'>(</span>noiseLevel <span class='op'>=</span> <span class='st'>"silent"</span>, cvType <span class='op'>=</span> <span class='st'>"auto"</span>, seed <span class='op'>=</span> <span class='fl'>1</span>, tolerance <span class='op'>=</span>
    <span class='fl'>2e-07</span>, cvRepetitions <span class='op'>=</span> <span class='fl'>10</span>, startingVariance <span class='op'>=</span> <span class='fl'>0.01</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cohortMethodData</th>
      <td><p>An object of type <a href='CohortMethodData-class.html'>CohortMethodData</a> as generated using
<code><a href='getDbCohortMethodData.html'>getDbCohortMethodData()</a></code>.</p></td>
    </tr>
    <tr>
      <th>population</th>
      <td><p>A data frame describing the population. This should at least have a
<code>rowId</code> column corresponding to the <code>rowId</code> column in the
<a href='CohortMethodData-class.html'>CohortMethodData</a> covariates object and a <code>treatment</code> column.
If population is not specified, the full population in the
<a href='CohortMethodData-class.html'>CohortMethodData</a> will be used.</p></td>
    </tr>
    <tr>
      <th>excludeCovariateIds</th>
      <td><p>Exclude these covariates from the propensity model.</p></td>
    </tr>
    <tr>
      <th>includeCovariateIds</th>
      <td><p>Include only these covariates in the propensity model.</p></td>
    </tr>
    <tr>
      <th>maxCohortSizeForFitting</th>
      <td><p>If the target or comparator cohort are larger than this number, they
will be downsampled before fitting the propensity model. The model
will be used to compute propensity scores for all subjects. The
purpose of the sampling is to gain speed. Setting this number to 0
means no downsampling will be applied.</p></td>
    </tr>
    <tr>
      <th>errorOnHighCorrelation</th>
      <td><p>If true, the function will test each covariate for correlation with
the treatment assignment. If any covariate has an unusually high
correlation (either positive or negative), this will throw and
error.</p></td>
    </tr>
    <tr>
      <th>stopOnError</th>
      <td><p>If an error occurr, should the function stop? Else, the two cohorts
will be assumed to be perfectly separable.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>The prior used to fit the model. See
<code><a href='https://rdrr.io/pkg/Cyclops/man/createPrior.html'>Cyclops::createPrior()</a></code> for details.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>The control object used to control the cross-validation used to
determine the hyperparameters of the prior (if applicable). See
<code><a href='https://rdrr.io/pkg/Cyclops/man/createControl.html'>Cyclops::createControl()</a></code> for details.</p></td>
    </tr>
    </table>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>cohortMethodDataSimulationProfile</span><span class='op'>)</span>
<span class='va'>cohortMethodData</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulateCohortMethodData.html'>simulateCohortMethodData</a></span><span class='op'>(</span><span class='va'>cohortMethodDataSimulationProfile</span>, n <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Generating covariates
#&gt; Generating treatment variable
#&gt; Generating cohorts
#&gt; Generating outcomes after index date
#&gt; Generating outcomes before index date</div><div class='input'><span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='fu'>createPs</span><span class='op'>(</span><span class='va'>cohortMethodData</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Removing 1 redundant covariates
#&gt; Removing 0 infrequent covariates
#&gt; Normalizing covariates
#&gt; Tidying covariates took 0.782 secs</div><div class='output co'>#&gt; <span class='warning'>Warning: All coefficients (except maybe the intercept) are zero. Either the covariates are completely uninformative or completely predictive of the treatment. Did you remember to exclude the treatment variables from the covariates?</span></div><div class='output co'>#&gt; Creating propensity scores took 3.79 secs</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Martijn Schuemie, Marc Suchard, Patrick Ryan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


